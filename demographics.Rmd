---
title: "Who is participating?"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    theme: paper
---

```{r, echo = F}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
options(knitr.kable.NA = '')
```

```{r packages}
library(here)
library(tidyverse)
library(knitr)
library(kableExtra)
library(haven)
# require(devtools)
# install_version("zipcode", version = "1.0", repos = "http://cran.us.r-project.org")
library(zipcode)
library(ggthemr)
library(maps)
library(usmap)
library(ggsn)
```

```{r score datafile, echo = F, warning = F, message = F}
source(here("Scripts/score data.R"))
```


```{r, key demographics}
source(here("Scripts/demo groups.R"))
```

```{r}
max_weeks = max(scored$Week, na.rm=T)
start_dates = seq(as.Date("2020-04-07"), by = 7, length.out = max_weeks)
end_dates = seq(as.Date("2020-04-13"), by = 7, length.out = max_weeks)
start_dates[1] = as.Date("2020-04-06")

start_dates = format(start_dates, format = "%B %d")
end_dates = format(end_dates, format = "%B %d")

all_dates = paste(start_dates, "-", end_dates)
```

# Across all parents sampled

```{r, results = 'asis'}
scored %>%
  filter(Week > 0) %>%
  group_by(CaregiverID) %>%
  filter(Week == min(Week)) %>%
  ungroup() %>%
  select(all_of(binary_demos)) %>%
  gather("Demographic", "value") %>%
  group_by(Demographic) %>%
  summarize(Count = sum(value,na.rm=T),
            total = n()) %>%
  mutate(Demographic = factor(Demographic, 
                              levels = binary_demos, 
                              labels = binary_labels),
         Percent = 100*Count/total) %>%
  select(Demographic, Count, Percent) %>%
  kable(., col.names = c("Demographic", "Count", "Percent of sample"),
        digits = c(0,0,1)) %>%
  kable_styling() %>%
  scroll_box(width = "650px")
```


# Numbers by the week

```{r, results = 'asis'}
scored %>%
  filter(Week > 0) %>%
  select(Week, all_of(binary_demos)) %>%
  gather("Demographic", value, -Week) %>%
  group_by(Week, Demographic) %>%
  summarize(Count = sum(value,na.rm=T)) %>%
  mutate(Demographic = factor(Demographic, 
                              levels = binary_demos, 
                              labels = binary_labels)) %>%
  ungroup() %>%
  spread("Week", "Count") %>%
  kable(., col.names = c("Demographic", all_dates)) %>%
  kable_styling() %>%
  scroll_box(width = "650px")
```

